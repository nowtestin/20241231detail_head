<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller= function($scope) { 
    /* widget controller */ 

    var c = this;
    $scope.$watch (function() { 
        // 変数セットの内部名 'x63_pc_purhcase_variableset ' 
        return $scope.page.g_form.getValue('sinsei_jouhou'); 
    }, function(value) {
        if (value) { 
            var mrvsData = JSON.parse (value);
            // mrvsData [ sub_total );
            // typeof mrvsData ); データ種類を判別

            console.log(value);
            //合計の算出
            var TotalAmount = 0; 
            for (var i = 0; i < mrvsData.length ; i ++) { 
                mrvs = mrvsData[i];
                TotalAmount += parseInt(mrvs.sub_total); 
                // alert('この時点で :' + TotalAmount ); 
                // alert('計算中 : ' +TotalAmount + ' for ----> ' +mrvs.sub_total ); 
            } 

            //合計値をセット 
            // alert(TotalAmount );
            c.data.cost = TotalAmount ;
            $scope.page.g_form.setValue ('sum_cost',TotalAmount); 
        }else{
						console.log("else:" + value);
					  c.data.cost = '' ;
            //$scope.page.g_form.setValue ('sum_cost','');
					$scope.page.g_form.clearValue('sum_cost');
				}
    });
};

]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>totalpriceamomount</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>totalPriceAmomount</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {  /* populate the 'data' object */  /* e.g., data.table = $sp.getValue('table'); */})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-01-16 03:28:18</sys_created_on>
        <sys_id>7af11af6c34312107c94bb2ed4013167</sys_id>
        <sys_mod_count>24</sys_mod_count>
        <sys_name>totalPriceAmomount</sys_name>
        <sys_package display_value="head and detail test" source="x_846092_head_and">d8c61f59c3b21a104f6efc0ed40131ca</sys_package>
        <sys_policy/>
        <sys_scope display_value="head and detail test">d8c61f59c3b21a104f6efc0ed40131ca</sys_scope>
        <sys_update_name>sp_widget_7af11af6c34312107c94bb2ed4013167</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-01-17 06:24:04</sys_updated_on>
        <template><![CDATA[<div>
<!-- your widget template -->
    <input type="text" value ={{c.data.cost}} readonly >
</div>]]></template>
    </sp_widget>
</record_update>
